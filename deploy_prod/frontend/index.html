<!doctype html><html lang='en'><head><meta charset='UTF-8' /><meta name='viewport' content='width=device-width, initial-scale=1.0' /><title>HappyRentals</title><!-- HR_FETCH_AUTH_SHIM -->
<script>
(() => {
  const TOKEN_KEY = "hr_token";
  const origFetch = window.fetch.bind(window);

  function getToken() {
    try { return localStorage.getItem(TOKEN_KEY) || ""; } catch { return ""; }
  }
  function getUrl(input) {
    if (typeof input === "string") return input;
    if (input && typeof input.url === "string") return input.url;
    return "";
  }
  function isApiUrl(url) {
    return !!url && (url.includes("/api/") || url.startsWith("/api/") || url.startsWith("api/"));
  }
  function isAuthUrl(url) {
    return !!url && (url.includes("/api/auth/") || url.startsWith("/api/auth/") || url.startsWith("api/auth/"));
  }

  window.fetch = (input, init = {}) => {
    const url = getUrl(input);

    if (isApiUrl(url)) {
      init = { ...init, credentials: "include" };

      const token = getToken();
      if (token) {
        const headers = new Headers(init.headers || (input instanceof Request ? input.headers : undefined));
        if (!headers.get("Authorization")) headers.set("Authorization", "Bearer " + token);
        init = { ...init, headers };
      }
    }

    const nextInput = (input instanceof Request) ? new Request(input, init) : input;

    return origFetch(nextInput, init).then((res) => {
      if (res.status === 401 && isApiUrl(url) && !isAuthUrl(url)) {
        try { localStorage.removeItem(TOKEN_KEY); } catch {}
        if (!window.location.pathname.startsWith("/login")) {
          const next = encodeURIComponent(window.location.pathname + window.location.search);
          window.location.replace("/login?next=" + next);
        }
      }
      return res;
    });
  };
})();
</script>
<!-- /HR_FETCH_AUTH_SHIM -->
</head><body><div id='root'></div><script type='module' src='/src/main.tsx'></script></body></html>


